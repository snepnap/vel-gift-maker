<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine Builder â€¢ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           VALENTINE BUILDER - v0.dev Inspired Design
           Romantic â€¢ Elegant â€¢ Premium â€¢ Pink Aesthetic
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* === IMPORTS === */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');

        :root {
            /* â•â•â• Romantic Color Palette â•â•â• */
            --bg-primary: #FDF2F4;
            --bg-secondary: #FFFFFF;
            --bg-soft-pink: #FFE4E9;
            --bg-rose: #FFF0F3;

            /* â•â•â• Pink Shades â•â•â• */
            --pink-50: #FFF1F2;
            --pink-100: #FFE4E6;
            --pink-200: #FECDD3;
            --pink-300: #FDA4AF;
            --pink-400: #FB7185;
            --pink-500: #F43F5E;
            --pink-600: #E11D48;
            --pink-700: #BE123C;

            /* â•â•â• Text Colors â•â•â• */
            --text-primary: #1F1F1F;
            --text-secondary: #6B7280;
            --text-muted: #9CA3AF;
            --text-pink: #E11D48;

            /* â•â•â• UI Elements â•â•â• */
            --border-light: rgba(0, 0, 0, 0.06);
            --border-pink: rgba(225, 29, 72, 0.2);
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.12);
            --shadow-pink: 0 4px 20px rgba(225, 29, 72, 0.15);

            /* â•â•â• Radii â•â•â• */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-2xl: 32px;

            /* â•â•â• Typography â•â•â• */
            --font-display: 'Playfair Display', Georgia, serif;
            --font-body: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;

            /* â•â•â• Animation â•â•â• */
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESET & BASE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SOFT GRADIENT BACKGROUND
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .aurora-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            background: linear-gradient(135deg,
                    #FDF2F4 0%,
                    #FFE4E9 25%,
                    #FFF0F3 50%,
                    #FECDD3 75%,
                    #FFE4E6 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .noise-overlay {
            display: none;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LAYOUT - Preview on RIGHT
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .layout-premium {
            display: grid;
            grid-template-columns: 320px 1fr 400px;
            height: 100vh;
            background: transparent;
            position: relative;
            z-index: 2;
        }

        .layout-premium.panel-closed {
            grid-template-columns: 320px 1fr 0px;
        }

        .layout-premium.panel-closed .right-panel {
            width: 0;
            opacity: 0;
            pointer-events: none;
            overflow: hidden;
            padding: 0;
            border: none;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LEFT SIDEBAR - Templates & Navigation
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .dock-sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 100;
        }

        .dock-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-light);
        }

        .dock-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dock-logo-icon {
            font-size: 24px;
        }

        .dock-title {
            font-family: var(--font-display);
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .dock-subtitle {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .dock-nav {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
            overflow-y: auto;
        }

        .dock-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .dock-item:hover {
            background: var(--bg-soft-pink);
            color: var(--text-pink);
        }

        .dock-item.active {
            background: linear-gradient(135deg, var(--pink-500), var(--pink-600));
            color: white;
            box-shadow: var(--shadow-pink);
        }

        .dock-item svg {
            width: 20px;
            height: 20px;
        }

        .dock-divider {
            height: 1px;
            background: var(--border-light);
            margin: 12px 0;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CENTER - Preview Area (Phone Preview)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .canvas-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
            background: transparent;
            overflow: hidden;
        }

        /* Floating hearts decoration */
        .canvas-area::before {
            content: 'ğŸ’•';
            position: absolute;
            top: 10%;
            left: 10%;
            font-size: 32px;
            opacity: 0.3;
            animation: float 6s ease-in-out infinite;
        }

        .canvas-area::after {
            content: 'ğŸ’—';
            position: absolute;
            bottom: 15%;
            right: 10%;
            font-size: 40px;
            opacity: 0.25;
            animation: float 8s ease-in-out infinite reverse;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PREVIEW CONTAINER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .preview-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            width: 100%;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DESKTOP PREVIEW (Browser Mockup)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .preview-desktop {
            width: 800px;
            height: 520px;
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border-light);
        }

        .preview-desktop::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to right, var(--pink-50), var(--bg-secondary));
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            padding: 0 16px;
        }

        .preview-desktop::after {
            content: 'â— â— â—';
            position: absolute;
            top: 12px;
            left: 16px;
            font-size: 10px;
            letter-spacing: 4px;
            color: var(--pink-300);
            z-index: 5;
        }

        .preview-desktop iframe {
            margin-top: 40px;
            height: calc(100% - 40px);
            border: none;
            width: 100%;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MOBILE PREVIEW (Titanium Frame)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .titanium-frame {
            width: 320px;
            height: 660px;
            background: linear-gradient(145deg, #3D3D3D, #1A1A1A);
            border-radius: 52px;
            padding: 14px;
            position: relative;
            box-shadow:
                0 25px 80px rgba(0, 0, 0, 0.35),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset,
                0 -1px 0 rgba(255, 255, 255, 0.15) inset;
        }

        .titanium-frame.landscape {
            width: 660px;
            height: 320px;
            border-radius: 36px;
        }

        .titanium-screen {
            width: 100%;
            height: 100%;
            background: var(--bg-secondary);
            border-radius: 40px;
            overflow: hidden;
            position: relative;
        }

        .titanium-frame.landscape .titanium-screen {
            border-radius: 28px;
        }

        .titanium-notch {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90px;
            height: 26px;
            background: #000;
            border-radius: 14px;
            z-index: 10;
        }

        .titanium-notch::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: #1C1C1C;
            border-radius: 50%;
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .titanium-frame::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TOOLBAR
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .toolbar {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-xl);
            padding: 6px 8px;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 50;
            box-shadow: var(--shadow-md);
        }

        .toolbar-btn {
            padding: 10px 18px;
            border-radius: var(--radius-md);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            border: none;
            font-family: var(--font-body);
            font-weight: 500;
            font-size: 13px;
        }

        .toolbar-btn:hover {
            background: var(--bg-soft-pink);
            color: var(--text-pink);
        }

        .toolbar-btn.active {
            background: linear-gradient(135deg, var(--pink-500), var(--pink-600));
            color: white;
        }

        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: var(--border-light);
            margin: 0 8px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RIGHT PANEL - Content Editor (Preview is CENTER now)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .right-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s var(--ease-out);
        }

        .panel-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--pink-50), var(--bg-secondary));
        }

        .panel-title {
            font-family: var(--font-display);
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .panel-subtitle {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .panel-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            border: none;
            font-size: 18px;
        }

        .panel-close:hover {
            background: var(--pink-100);
            color: var(--text-pink);
        }

        .panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .panel-body::-webkit-scrollbar {
            width: 6px;
        }

        .panel-body::-webkit-scrollbar-track {
            background: transparent;
        }

        .panel-body::-webkit-scrollbar-thumb {
            background: var(--pink-200);
            border-radius: 3px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FORM ELEMENTS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input,
        input,
        textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 14px;
            font-family: var(--font-body);
            transition: all 0.2s var(--ease-out);
        }

        .form-input:focus,
        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--pink-400);
            box-shadow: 0 0 0 3px rgba(244, 63, 94, 0.1);
            background: var(--bg-secondary);
        }

        .form-input::placeholder,
        input::placeholder,
        textarea::placeholder {
            color: var(--text-muted);
        }

        textarea.form-input,
        textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BUTTONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .btn,
        button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            font-family: var(--font-body);
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--pink-500), var(--pink-600));
            color: white;
            box-shadow: var(--shadow-pink);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(225, 29, 72, 0.25);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--pink-50);
            border-color: var(--pink-200);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           THEME CAROUSEL
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .theme-carousel {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 4px 0;
        }

        .carousel-card,
        .theme-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px;
            border-radius: var(--radius-lg);
            position: relative;
            cursor: pointer;
            border: 1px solid var(--border-light);
            transition: all 0.25s var(--ease-out);
            background: var(--bg-secondary);
        }

        .carousel-card:hover,
        .theme-card:hover {
            border-color: var(--pink-200);
            background: var(--pink-50);
        }

        .carousel-card.active,
        .theme-card.active,
        .theme-card.selected {
            border-color: var(--pink-400);
            background: linear-gradient(135deg, var(--pink-500), var(--pink-600));
            color: white;
            box-shadow: var(--shadow-pink);
        }

        .carousel-preview-bg,
        .theme-preview {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .carousel-info,
        .theme-info {
            flex: 1;
        }

        .carousel-name,
        .theme-name {
            font-weight: 600;
            font-size: 14px;
            color: inherit;
        }

        .carousel-desc {
            font-size: 12px;
            color: inherit;
            opacity: 0.75;
            margin-top: 2px;
        }

        .carousel-card.active .carousel-name,
        .carousel-card.active .carousel-desc,
        .theme-card.active .theme-name,
        .theme-card.selected .theme-name {
            color: white;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FEATURE CARDS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .feature-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
        }

        .feature-card:hover {
            border-color: var(--pink-200);
            background: var(--pink-50);
        }

        .feature-card.active {
            background: linear-gradient(135deg, var(--pink-500), var(--pink-600));
            border-color: transparent;
            color: white;
        }

        .feature-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .feature-name {
            font-size: 13px;
            font-weight: 600;
            color: inherit;
        }

        .feature-price {
            font-size: 12px;
            color: inherit;
            opacity: 0.75;
            margin-top: 4px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ACTION BAR (Bottom)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .action-bar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-2xl);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .action-bar .btn {
            padding: 10px 20px;
            font-size: 13px;
        }

        .price-display {
            padding: 10px 16px;
            background: var(--pink-50);
            border-radius: var(--radius-lg);
            font-weight: 600;
            color: var(--text-pink);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LOADER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid var(--pink-100);
            border-top-color: var(--pink-500);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COLOR SWATCHES
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 12px;
        }

        .color-swatch {
            width: 100%;
            aspect-ratio: 1;
            border-radius: var(--radius-sm);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s var(--ease-spring);
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        .color-swatch.active {
            border-color: var(--text-primary);
            box-shadow: var(--shadow-md);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FONT SELECTOR
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .font-option {
            padding: 14px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .font-option:hover {
            border-color: var(--pink-200);
            background: var(--pink-50);
        }

        .font-option.active {
            background: linear-gradient(135deg, var(--pink-500), var(--pink-600));
            border-color: transparent;
            color: white;
        }

        .font-preview {
            font-size: 16px;
        }

        .font-name {
            font-size: 12px;
            font-weight: 500;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TOAST NOTIFICATIONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 14px 24px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s var(--ease-out);
            box-shadow: var(--shadow-lg);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            background: #ECFDF5;
            border-color: #10B981;
            color: #065F46;
        }

        .toast.error {
            background: #FEF2F2;
            border-color: #EF4444;
            color: #991B1B;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MODAL
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 32px;
            max-width: 440px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95) translateY(20px);
            transition: all 0.3s var(--ease-spring);
            box-shadow: var(--shadow-lg);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-family: var(--font-display);
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PROGRESS BAR
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--pink-100);
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--pink-400), var(--pink-500), var(--pink-600));
            transition: width 0.5s var(--ease-out);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           GRADIENT MESH (hidden)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .gradient-mesh {
            display: none;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESPONSIVE DESIGN
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 1280px) {
            .layout-premium {
                grid-template-columns: 280px 1fr 360px;
            }

            .preview-desktop {
                width: 700px;
                height: 460px;
            }
        }

        @media (max-width: 1024px) {
            .layout-premium {
                grid-template-columns: 1fr;
            }

            .dock-sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: auto;
                flex-direction: row;
                border-right: none;
                border-top: 1px solid var(--border-light);
                z-index: 200;
            }

            .dock-header {
                display: none;
            }

            .dock-nav {
                flex-direction: row;
                justify-content: center;
                padding: 12px;
            }

            .canvas-area {
                padding-bottom: 140px;
            }

            .right-panel {
                position: fixed;
                right: 0;
                top: 0;
                bottom: 0;
                width: 360px;
                z-index: 200;
                transform: translateX(100%);
                transition: transform 0.3s var(--ease-out);
            }

            .right-panel.open {
                transform: translateX(0);
            }
        }

        @media (max-width: 640px) {
            .preview-desktop {
                width: 100%;
                max-width: 360px;
                height: 480px;
            }

            .titanium-frame {
                width: 280px;
                height: 580px;
            }

            .right-panel {
                width: 100%;
            }

            .action-bar {
                width: calc(100% - 32px);
                justify-content: center;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MODAL BACKDROP & CARD
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s var(--ease-out);
        }

        .modal-backdrop.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 32px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s var(--ease-spring);
        }

        .modal-backdrop.open .modal-card {
            transform: scale(1) translateY(0);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BOTTOM ACTION BAR (Floating)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .bottom-action-bar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-2xl);
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--pink-50);
            border-radius: var(--radius-lg);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-pink);
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--pink-500);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(0.9);
            }
        }

        .action-divider {
            width: 1px;
            height: 24px;
            background: var(--border-light);
            margin: 0 4px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            font-family: var(--font-body);
            white-space: nowrap;
        }

        .action-btn:hover {
            background: var(--pink-50);
            color: var(--text-pink);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--pink-500), var(--pink-600));
            color: white;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-pink);
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(225, 29, 72, 0.3);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SECONDARY BUTTON STYLE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
        }

        .btn-secondary:hover {
            background: var(--pink-50);
            border-color: var(--pink-200);
        }

        .btn-no {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 12px;
            transition: color 0.2s;
        }


        .btn-no:hover {
            color: var(--text-secondary);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FEATURE GRID (with active states)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 10px;
            background: var(--bg-primary);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s var(--ease-out);
            text-align: center;
        }

        .feature-item:hover {
            border-color: var(--pink-200);
            background: var(--pink-50);
        }

        .feature-item.active {
            border-color: var(--pink-500);
            background: linear-gradient(135deg, var(--pink-50), var(--pink-100));
            box-shadow: 0 0 0 3px rgba(244, 63, 94, 0.15);
        }

        .feature-item.active::after {
            content: 'âœ“';
            position: absolute;
            top: 6px;
            right: 6px;
            width: 18px;
            height: 18px;
            background: var(--pink-500);
            color: white;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feature-item {
            position: relative;
        }

        .feature-item .icon {
            font-size: 24px;
        }

        .feature-item .name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .feature-item .price {
            font-size: 11px;
            color: var(--text-muted);
        }

        .feature-item.active .name {
            color: var(--pink-600);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           THEME THUMBNAILS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .theme-thumb {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PUBLISH AREA
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .publish-area {
            padding: 16px;
            border-top: 1px solid var(--border-light);
            background: var(--bg-secondary);
            position: sticky;
            bottom: 0;
        }

        .publish-area .btn-primary {
            width: 100%;
            padding: 14px;
            font-size: 15px;
        }

        .kbd {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 4px 8px;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            font-size: 11px;
            font-family: var(--font-body);
            color: var(--text-muted);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PREVIEW PLACEHOLDER (Dynamic)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .preview-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            gap: 16px;
            color: var(--text-muted);
            background: linear-gradient(135deg, var(--pink-50), var(--bg-primary));
            position: relative;
            overflow: hidden;
        }

        .preview-placeholder-icon {
            font-size: 64px;
            animation: pulse-icon 2s ease-in-out infinite;
        }

        @keyframes pulse-icon {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .preview-placeholder-text {
            font-size: 14px;
            text-align: center;
            max-width: 280px;
        }

        .preview-placeholder-hint {
            font-size: 12px;
            color: var(--text-muted);
            opacity: 0.7;
        }

        /* Floating Hearts Animation */
        .floating-heart {
            position: absolute;
            font-size: 20px;
            opacity: 0.6;
            animation: float-up 4s ease-in-out infinite;
        }

        .floating-heart:nth-child(1) {
            left: 10%;
            animation-delay: 0s;
            animation-duration: 3.5s;
        }

        .floating-heart:nth-child(2) {
            left: 20%;
            animation-delay: 0.5s;
            animation-duration: 4s;
        }

        .floating-heart:nth-child(3) {
            left: 35%;
            animation-delay: 1s;
            animation-duration: 3.8s;
        }

        .floating-heart:nth-child(4) {
            left: 50%;
            animation-delay: 1.5s;
            animation-duration: 4.2s;
        }

        .floating-heart:nth-child(5) {
            left: 65%;
            animation-delay: 2s;
            animation-duration: 3.6s;
        }

        .floating-heart:nth-child(6) {
            left: 80%;
            animation-delay: 0.3s;
            animation-duration: 4.5s;
        }

        .floating-heart:nth-child(7) {
            left: 90%;
            animation-delay: 0.8s;
            animation-duration: 3.9s;
        }

        @keyframes float-up {
            0% {
                bottom: -30px;
                opacity: 0;
                transform: translateX(0) rotate(0deg);
            }

            10% {
                opacity: 0.6;
            }

            90% {
                opacity: 0.6;
            }

            100% {
                bottom: 100%;
                opacity: 0;
                transform: translateX(20px) rotate(15deg);
            }
        }

        /* Shimmer text animation */
        .shimmer-text {
            background: linear-gradient(90deg, #fff 0%, #ffd1d9 50%, #fff 100%);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% center;
            }

            100% {
                background-position: 200% center;
            }
        }

        /* Gradient background animation */
        .animated-gradient {
            background-size: 200% 200%;
            animation: gradient-shift 5s ease infinite;
        }

        @keyframes gradient-shift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COUNTDOWN / DAYS INPUT
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .days-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .days-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .days-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           REDUCED MOTION
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const FEATURES = [
            { id: 'feature_gallery', icon: 'ğŸ“¸', label: 'Photo Gallery', price: 9 },
            { id: 'feature_music', icon: 'ğŸµ', label: 'Custom Music', price: 9 },
            { id: 'feature_timeline', icon: 'ğŸ“…', label: 'Love Timeline', price: 15 },
            { id: 'feature_quiz', icon: 'â“', label: 'Love Quiz', price: 9 },
            { id: 'feature_gift', icon: 'ğŸ', label: 'Virtual Gift', price: 15 },
            { id: 'feature_countdown', icon: 'â³', label: 'Countdown', price: 5 },
            { id: 'feature_password', icon: 'ğŸ”’', label: 'Password Lock', price: 5 },
            { id: 'feature_scratch', icon: 'âœ¨', label: 'Scratch Card', price: 19 },
            { id: 'feature_spin', icon: 'ğŸ¡', label: 'Spin Wheel', price: 19 },
            { id: 'feature_memory', icon: 'ğŸ§ ', label: 'Memory Game', price: 19 },
            { id: 'feature_video', icon: 'ğŸ¥', label: 'Video Message', price: 25 },
            { id: 'feature_confetti', icon: 'ğŸ‰', label: 'Confetti Rain', price: 5 }
        ];





        const COLORS = [
            { id: 'rose', color: '#f43f5e', name: 'Rose' },
            { id: 'pink', color: '#ec4899', name: 'Pink' },
            { id: 'purple', color: '#a855f7', name: 'Purple' },
            { id: 'violet', color: '#8b5cf6', name: 'Violet' },
            { id: 'gold', color: '#f59e0b', name: 'Gold' },
            { id: 'red', color: '#ef4444', name: 'Red' }
        ];

        const FONTS = [
            { id: 'playfair', name: 'Playfair Display', preview: 'Romantic', style: 'serif' },
            { id: 'dancing', name: 'Dancing Script', preview: 'Elegant', style: 'cursive' },
            { id: 'inter', name: 'Inter', preview: 'Modern', style: 'sans-serif' },
            { id: 'cinzel', name: 'Cinzel', preview: 'Classic', style: 'serif' }
        ];

        const TEMPLATES = [
            {
                id: 'romantic', icon: 'ğŸ’•', name: 'Classic Romance',
                desc: 'Elegant and heartfelt',
                config: {
                    message: "My dearest love,\n\nEvery moment with you is a treasure. You are my everything.\n\nForever yours.",
                    theme: 'cosmic',
                    features: ['feature_gallery', 'feature_timeline', 'feature_music'],
                    timeline: [
                        { date: "When We Met", title: "Love at First Sight", description: "The moment our eyes met, I knew you were special." },
                        { date: "Our First Date", title: "Magic Happened", description: "Coffee, laughter, and endless conversation." },
                        { date: "Today", title: "Still Falling", description: "Every day I fall more in love with you." }
                    ]
                }
            },
            {
                id: 'playful', icon: 'ğŸ‰', name: 'Playful & Fun',
                desc: 'Bright and energetic',
                config: {
                    message: "Hey you! ğŸ˜Š\n\nYou make every day an adventure. Let's create more memories together!\n\nLove you tons!",
                    theme: 'sakura',
                    features: ['feature_gallery', 'feature_quiz', 'feature_gift'],
                    quiz: { question: "What's my favorite thing about you?", options: ["Your smile", "Your laugh", "Your hugs", "Everything!"], correctIndex: 3 }
                }
            },
            {
                id: 'minimal', icon: 'âœ¨', name: 'Elegant Minimal',
                desc: 'Clean and simple',
                config: {
                    message: "To my love,\n\nSimple words cannot express how I feel. You complete me.\n\nAlways.",
                    theme: 'minimal',
                    features: ['feature_gallery', 'feature_countdown']
                }
            },
            {
                id: 'poetic', icon: 'ğŸ“œ', name: 'Poetic Soul',
                desc: 'Literary and deep',
                config: {
                    message: "My Beloved,\n\nLike the stars that paint the midnight sky, your love illuminates my world. In the garden of my heart, you are the most beautiful flower.\n\nEternally yours.",
                    theme: 'rose_garden',
                    features: ['feature_timeline', 'feature_music', 'feature_countdown'],
                    timeline: [
                        { date: "Chapter 1", title: "Destiny's Meeting", description: "Two souls destined to find each other." },
                        { date: "Chapter 2", title: "Growing Together", description: "Through every season, our love bloomed." },
                        { date: "Chapter 3", title: "Forever After", description: "The story continues, written by us." }
                    ]
                }
            },
            {
                id: 'cosmic', icon: 'ğŸª', name: 'Cosmic Adventure',
                desc: 'Dark mode with sparkles',
                config: {
                    message: "You are my universe,\n\nIn the vastness of space, I found you. My star, my moon, my everything.\n\nAcross galaxies, I'd find you again.",
                    theme: 'cosmic',
                    features: ['feature_gallery', 'feature_timeline', 'feature_quiz', 'feature_gift']
                }
            },
            {
                id: 'neon', icon: 'ğŸ’œ', name: 'Cyberpunk Love',
                desc: 'Futuristic neon vibes',
                config: {
                    message: "[LOVE.EXE INITIATED]\n\nYou've hacked my heart.\nNo firewall can stop my feelings.\n\n[STATUS: FOREVER YOURS]",
                    theme: 'neon',
                    features: ['feature_gallery', 'feature_quiz', 'feature_gift', 'feature_password']
                }
            },
            {
                id: 'vintage', icon: 'ğŸ•¯ï¸', name: 'Vintage Letter',
                desc: 'Old-fashioned charm',
                config: {
                    message: "My Dearest,\n\nIn this modern world, my love for you is timeless. Like letters of old, my feelings are penned with care.\n\nYours always.",
                    theme: 'vintage',
                    features: ['feature_gallery', 'feature_timeline']
                }
            },
            {
                id: 'v0_presentation', icon: 'ğŸ’', name: 'v0 Modern Presentation',
                desc: 'Premium multi-section design',
                config: {
                    tagline: "To the love of my life",
                    message: "My dearest,\n\nYou are my sun, my moon, and all my stars. Every section of this page is a small piece of our beautiful story.\n\nEternally yours.",
                    theme: 'cosmic',
                    reasons: [
                        { title: "Your Smile", body: "It lights up my darkest days." },
                        { title: "Your Kindness", body: "The way you care for everyone." },
                        { title: "Your Support", body: "You are always there for me." },
                        { title: "Your Laugh", body: "The sweetest sound I've heard." },
                        { title: "Your Heart", body: "Generous, loving, and beautiful." },
                        { title: "Your Presence", body: "Simply being near you is enough." }
                    ],
                    timeline: [
                        { date: "Day We Met", title: "The Beginning", description: "The stars aligned." },
                        { date: "First Date", title: "Coffee & Talks", description: "Endless conversations." },
                        { date: "Today", title: "Still Falling", description: "I love you more than yesterday." }
                    ],
                    features: ['feature_gallery', 'feature_timeline', 'feature_confetti']
                }
            }
        ];

        const VALENTINE_WEEK = [
            { id: 'all', icon: 'â¤ï¸', label: 'All Days' },
            { id: 'rose', icon: 'ğŸŒ¹', label: 'Rose Day (Feb 7)', theme: 'rose_garden' },
            { id: 'propose', icon: 'ğŸ’', label: 'Propose Day (Feb 8)', theme: 'minimal' },
            { id: 'chocolate', icon: 'ğŸ«', label: 'Chocolate Day (Feb 9)', theme: 'vintage' },
            { id: 'teddy', icon: 'ğŸ§¸', label: 'Teddy Day (Feb 10)', theme: 'cloud' },
            { id: 'promise', icon: 'ğŸ¤', label: 'Promise Day (Feb 11)', theme: 'luxury' },
            { id: 'hug', icon: 'ğŸ«‚', label: 'Hug Day (Feb 12)', theme: 'polaroid' },
            { id: 'kiss', icon: 'ğŸ’‹', label: 'Kiss Day (Feb 13)', theme: 'neon' },
            { id: 'valentine', icon: 'ğŸ’˜', label: 'Valentine\'s Day (Feb 14)', theme: 'cosmic' }
        ];

        const THEMES = [
            // APP STYLES
            { id: 'music', template: 'music', icon: 'ğŸµ', name: 'Melody (Spotify)', bg: '#1db954', desc: 'Music player style', config: { style: 'music', primaryColor: '#1db954' }, tags: ['cool', 'modern'] },
            { id: 'stream', template: 'stream', icon: 'ğŸ¬', name: 'Movie Night (Netflix)', bg: '#e50914', desc: 'Streaming service vibe', config: { style: 'stream', primaryColor: '#e50914' }, tags: ['cool', 'modern'] },
            { id: 'chat', template: 'chat', icon: 'ğŸ’¬', name: 'Love Chat', bg: '#25d366', desc: 'Messaging app style', config: { style: 'chat', primaryColor: '#25d366' }, tags: ['modern', 'fun'] },
            { id: 'social', template: 'social', icon: 'ğŸ“¸', name: 'InstaLove', bg: '#d62976', desc: 'Social feed style', config: { style: 'social', primaryColor: '#d62976' }, tags: ['modern', 'fun'] },

            // ROMANTIC & JOURNAL STYLES
            { id: 'cosmic', template: 'cosmic', icon: 'ğŸª', name: 'Cosmic Love', bg: '#0f0c29', desc: 'Magical space particles', config: { style: 'cosmic', primaryColor: '#8b5cf6' }, tags: ['romantic', 'dark'] },
            { id: 'rose_garden', template: 'journal', icon: 'ğŸŒ¹', name: 'Rose Garden', bg: '#e11d48', desc: 'Falling petals & bloom', config: { style: 'rose_garden', primaryColor: '#e11d48' }, tags: ['romantic', 'rose'] },
            { id: 'vintage', template: 'journal', icon: 'ğŸ“œ', name: 'Vintage Letter', bg: '#d4a373', desc: 'Old paper & nostalgia', config: { style: 'vintage', primaryColor: '#8b4513' }, tags: ['classy', 'chocolate'] },
            { id: 'luxury', template: 'universal', icon: 'âœ¨', name: 'Gold Luxury', bg: '#000000', desc: 'Black & Gold elegance', config: { style: 'luxury', primaryColor: '#d4af37' }, tags: ['classy', 'promise'] },
            { id: 'cloud', template: 'nature', icon: 'â˜ï¸', name: 'Lavender Haze', bg: '#a78bfa', desc: 'Soft clouds & dreams', config: { style: 'cloud', primaryColor: '#a78bfa' }, tags: ['cute', 'teddy'] },
            { id: 'sakura', template: 'journal', icon: 'ğŸŒ¸', name: 'Sakura Season', bg: '#fbcfe8', desc: 'Japanese cherry blossoms', config: { style: 'romantic', primaryColor: '#fbcfe8' }, tags: ['romantic', 'cute'] },
            { id: 'pixel', template: 'arcade', icon: 'ğŸ‘¾', name: '8-Bit Heart', bg: '#3b82f6', desc: 'Retro gaming style', config: { style: 'pixel', primaryColor: '#33ff00' }, tags: ['fun', 'cool'] },
            { id: 'polaroid', template: 'journal', icon: 'ğŸ–¼ï¸', name: 'Memory Wall', bg: '#fffbeb', desc: 'Polaroid gallery focus', config: { style: 'polaroid', primaryColor: '#be123c' }, tags: ['photo', 'hug'] },
            { id: 'minimal', template: 'universal', icon: 'âšª', name: 'Pure Minimal', bg: '#f3f4f6', desc: 'Clean & typographic', config: { style: 'minimal', primaryColor: '#000000' }, tags: ['clean', 'propose'] },
            { id: 'nature', template: 'nature', icon: 'ğŸŒ¿', name: 'Enchanted Forest', bg: '#059669', desc: 'Fireflies & greenery', config: { style: 'nature', primaryColor: '#10b981' }, tags: ['nature'] },
            { id: 'ocean', template: 'nature', icon: 'ğŸŒŠ', name: 'Deep Ocean', bg: '#0891b2', desc: 'Underwater bubbles', config: { style: 'ocean', primaryColor: '#06b6d4' }, tags: ['nature'] },
            { id: 'sunset', template: 'nature', icon: 'ğŸŒ…', name: 'Sunset Blvd', bg: '#f97316', desc: 'Warm gradients', config: { style: 'sunset', primaryColor: '#f97316' }, tags: ['romantic'] },

            // NEW THEMES 2025
            { id: 'aurora', template: 'cosmic', icon: 'ğŸŒŒ', name: 'Aurora Dream', bg: 'linear-gradient(135deg, #0f172a, #22d3ee, #f472b6)', desc: 'Northern lights magic', config: { style: 'aurora', primaryColor: '#22d3ee' }, tags: ['romantic', 'magical', 'dark'] },
            { id: 'underwater', template: 'cosmic', icon: 'ğŸ ', name: 'Underwater Love', bg: '#006994', desc: 'Deep sea romance', config: { style: 'underwater', primaryColor: '#006994' }, tags: ['nature', 'calm', 'ocean'] },
            { id: 'galaxy', template: 'cosmic', icon: 'âœ¨', name: 'Galaxy Lovers', bg: '#1a0033', desc: 'Swirling cosmos', config: { style: 'galaxy', primaryColor: '#8b5cf6' }, tags: ['cosmic', 'dark', 'romantic'] },
            { id: 'meadow', template: 'nature', icon: 'ğŸŒ¼', name: 'Spring Meadow', bg: '#7cb342', desc: 'Blooming flowers', config: { style: 'meadow', primaryColor: '#84cc16' }, tags: ['nature', 'cheerful', 'spring'] },
            { id: 'citynight', template: 'cosmic', icon: 'ğŸŒƒ', name: 'City Lights', bg: '#1e1e2e', desc: 'Urban skyline romance', config: { style: 'citynight', primaryColor: '#f59e0b' }, tags: ['modern', 'urban', 'dark'] },

            { id: 'neon', template: 'cosmic', icon: 'ğŸ’œ', name: 'Cyberpunk', bg: '#7e22ce', desc: 'Futuristic neon', config: { style: 'neon', primaryColor: '#a855f7' }, tags: ['cool', 'kiss'] },
            { id: 'midnight', template: 'cosmic', icon: 'ğŸŒ™', name: 'Midnight', bg: '#1e293b', desc: 'Dark & simple', config: { style: 'dark', primaryColor: '#64748b' }, tags: ['dark'] }
        ];


        function App() {
            const [activeSection, setActiveSection] = useState('themes');
            const [mode, setMode] = useState('desktop');
            const [orientation, setOrientation] = useState('portrait');
            const [loading, setLoading] = useState(true);
            const [orderData, setOrderData] = useState(null);
            const [selectedFeatures, setSelectedFeatures] = useState(['feature_gallery', 'feature_timeline']);
            const [currentTheme, setCurrentTheme] = useState('cosmic');
            const [accentColor, setAccentColor] = useState('rose');
            const [selectedFont, setSelectedFont] = useState('playfair');
            const [animationLevel, setAnimationLevel] = useState(2);

            // Pro Features State
            const [zoomLevel, setZoomLevel] = useState(100);
            const [soundEnabled, setSoundEnabled] = useState(true);
            const [autoSaveStatus, setAutoSaveStatus] = useState('saved');
            const [history, setHistory] = useState([]);
            const [historyIndex, setHistoryIndex] = useState(-1);

            // V16 Smart Features State
            const [aiModalOpen, setAiModalOpen] = useState(false);
            const [isRecording, setIsRecording] = useState(false);
            const [mediaRecorder, setMediaRecorder] = useState(null);

            // V17 UI State
            const [darkMode, setDarkMode] = useState(true);
            const [weekMode, setWeekMode] = useState('all'); // 'all', 'rose', 'propose', etc.

            // User Auth State
            const [currentUser, setCurrentUser] = useState(null);
            const [authModal, setAuthModal] = useState(null); // 'login' | 'register' | null
            const [authLoading, setAuthLoading] = useState(false);
            const [authError, setAuthError] = useState('');

            // My Orders State
            const [myOrders, setMyOrders] = useState([]);
            const [loadingOrders, setLoadingOrders] = useState(false);

            // Admin Testing Mode (accessed via ?admin=ADMIN_KEY)
            const [isAdminMode, setIsAdminMode] = useState(false);
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const adminKey = urlParams.get('admin');
                if (adminKey === 'admin123changeme') { // Matches .env ADMIN_KEY
                    setIsAdminMode(true);
                    console.log('ğŸ”§ Admin Testing Mode Enabled');
                }
            }, []);


            // Fetch Orders
            const fetchMyOrders = async () => {
                if (!currentUser) return;
                setLoadingOrders(true);
                try {
                    const res = await fetch('/api/my-orders', { credentials: 'include' });
                    const data = await res.json();
                    setMyOrders(Array.isArray(data) ? data : []);
                } catch (e) { console.error(e); }
                setLoadingOrders(false);
            };

            useEffect(() => {
                if (activeSection === 'orders') {
                    fetchMyOrders();
                }
            }, [activeSection, currentUser]);

            // Check if user is logged in on load
            useEffect(() => {
                fetch('/api/auth/me', { credentials: 'include' })
                    .then(r => r.json())
                    .then(data => {
                        if (data.success) setCurrentUser(data.user);
                    })
                    .catch(() => { });
            }, []);

            // Login function
            const handleLogin = async (email, password) => {
                setAuthLoading(true);
                setAuthError('');
                try {
                    const res = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ email, password })
                    });
                    const data = await res.json();
                    if (data.success) {
                        setCurrentUser(data.user);
                        setAuthModal(null);
                    } else {
                        setAuthError(data.error || 'Login failed');
                    }
                } catch (e) {
                    setAuthError('Login failed');
                }
                setAuthLoading(false);
            };

            // Register function
            const handleRegister = async (name, email, password) => {
                setAuthLoading(true);
                setAuthError('');
                try {
                    const res = await fetch('/api/auth/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ name, email, password })
                    });
                    const data = await res.json();
                    if (data.success) {
                        setCurrentUser(data.user);
                        setAuthModal(null);
                    } else {
                        setAuthError(data.error || 'Registration failed');
                    }
                } catch (e) {
                    setAuthError('Registration failed');
                }
                setAuthLoading(false);
            };

            // Logout function
            const handleLogout = async () => {
                await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
                setCurrentUser(null);
            };

            // Calculate progress
            const calculateProgress = () => {
                let filled = 0;
                let total = 6;
                if (config.partnerName) filled++;
                if (config.senderName) filled++;
                if (config.message.length > 20) filled++;
                if (config.gallery.length > 0) filled++;
                if (config.timeline.length > 0) filled++;
                if (selectedFeatures.length > 0) filled++;
                return Math.round((filled / total) * 100);
            };


            const generateLoveLetter = (mood) => {
                const name = config.partnerName || 'my love';
                const sender = config.senderName || 'Me';

                const data = {
                    romantic: {
                        tagline: "To the rhythm of my heartbeat",
                        message: `My dearest ${name},\n\nEvery day with you feels like a dream I never want to wake up from. You are the beat in my heart and the light in my life.\n\nForever yours,\n${sender}`,
                        reasons: [
                            { title: "Your Soul", body: "Pure, kind, and absolutely beautiful." },
                            { title: "The Way You Look At Me", body: "It makes me feel like the luckiest person alive." },
                            { title: "Your Kindness", body: "You care for everyone with such grace." },
                            { title: "Our Long Talks", body: "Time stops when I am with you." },
                            { title: "Your Strength", body: "You inspire me to be better every single day." },
                            { title: "Your Laugh", body: "The soundtrack to my happiest moments." }
                        ]
                    },
                    funny: {
                        tagline: "My favorite weirdo",
                        message: `Hey ${name}!\n\nI love you more than pizza (and that's saying a lot!). Thanks for putting up with my bad jokes and stealing my hoodies.\n\nLove,\n${sender}`,
                        reasons: [
                            { title: "Hoodie Thief", body: "You look better in my clothes anyway." },
                            { title: "Terrible Singer", body: "I still love your car concerts." },
                            { title: "Bad Jokes", body: "Someone has to laugh at mine." },
                            { title: "Shared Pizzas", body: "Even if you steal the last slice." },
                            { title: "Video Game Rival", body: "I let you win... sometimes." },
                            { title: "The Weirdness", body: "Thank God I found someone as weird as me." }
                        ]
                    },
                    poetic: {
                        tagline: "A soul's eternal destiny",
                        message: `To ${name},\n\nLike the stars guide the night, your love guides my soul. In this vast universe, finding you was my greatest destiny.\n\nEternally,\n${sender}`,
                        reasons: [
                            { title: "Starlight", body: "Your love illuminates my darkest paths." },
                            { title: "Eternity", body: "A thousand lifetimes wouldn't be enough." },
                            { title: "The Universe", body: "It conspired to bring our souls together." },
                            { title: "Poetry in Motion", body: "Everything you do is a masterpiece." },
                            { title: "Silence", body: "Even our quiet moments speak volumes." },
                            { title: "The Future", body: "A canvas waiting for our colors." }
                        ]
                    },
                    short: {
                        tagline: "Simply everything",
                        message: `${name}, you make my heart smile. Happy Valentine's Day! â¤ï¸\n\n- ${sender}`,
                        reasons: [
                            { title: "Everything", body: "You are the reason for my happiness." },
                            { title: "Smiles", body: "You bring them out so easily." },
                            { title: "Warmth", body: "Your love is my favorite place." },
                            { title: "Beauty", body: "Inside and out, you are perfect." },
                            { title: "Home", body: "With you, I am always where I belong." },
                            { title: "Always", body: "My heart is yours, forever." }
                        ]
                    }
                };

                const selectedData = data[mood];
                setConfig({
                    ...config,
                    tagline: selectedData.tagline,
                    message: selectedData.message,
                    reasons: selectedData.reasons
                });
                setAiModalOpen(false);
                setAutoSaveStatus('saved');
            };

            const toggleRecording = async () => {
                if (isRecording) {
                    mediaRecorder?.stop();
                    setIsRecording(false);
                } else {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        const recorder = new MediaRecorder(stream);
                        const chunks = [];
                        recorder.ondataavailable = e => chunks.push(e.data);
                        recorder.onstop = () => {
                            const blob = new Blob(chunks, { type: 'audio/mp3' });
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                setConfig({ ...config, musicUrl: e.target.result });
                                setAutoSaveStatus('saved');
                            };
                            reader.readAsDataURL(blob);
                            stream.getTracks().forEach(track => track.stop());
                        };
                        recorder.start();
                        setMediaRecorder(recorder);
                        setIsRecording(true);
                    } catch (e) { alert("Microphone access denied or not supported."); }
                }
            };


            const [config, setConfig] = useState({
                senderName: '', partnerName: '', tagline: 'To the love of my life', message: 'Every moment with you is magic...',
                musicUrl: 'https://res.cloudinary.com/dncywqfpb/video/upload/v1738399057/music_qzh0xk.mp3',
                giftUrl: 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48',
                reasons: [
                    { title: "Your Smile", body: "It lights up my darkest days." },
                    { title: "Your Kindness", body: "The way you care for everyone." },
                    { title: "Your Support", body: "You are always there for me." },
                    { title: "Your Laugh", body: "The sweetest sound I've heard." },
                    { title: "Your Heart", body: "Generous, loving, and beautiful." },
                    { title: "Your Presence", body: "Simply being near you is enough." }
                ],
                timeline: [
                    { date: "Day We Met", title: "The Beginning", description: "The stars aligned." },
                    { date: "First Date", title: "Coffee & Talks", description: "Endless conversations." }
                ],
                quiz: { question: "Where was our first date?", options: ["Cafe", "Park", "Cinema", "Beach"], correctIndex: 0 },
                gallery: [
                    "https://images.unsplash.com/photo-1518199266791-5375a83190b7",
                    "https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2",
                    "https://images.unsplash.com/photo-1529333166437-7750a6dd5a70"
                ],
                countdown: { enabled: false, date: "2026-02-14" },
                password: "",
                effects: { hearts: false, sparkles: false, bubbles: false }
            });

            const [deviceFrame, setDeviceFrame] = useState('iphone');

            const iframeRef = useRef(null);
            const baseUrl = window.location.origin;
            // Universal Theme Logic: Map themes to 'universal' template if specified
            const themeDef = THEMES.find(t => t.id === currentTheme);
            const templateDir = themeDef?.template || currentTheme;
            const previewUrl = `./templates/${templateDir}/index.html`;
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(previewUrl)}`;

            useEffect(() => {
                const themeDef = THEMES.find(t => t.id === currentTheme);
                const send = () => iframeRef.current?.contentWindow?.postMessage({
                    type: 'UPDATE_CONFIG',
                    payload: {
                        ...config,
                        style: themeDef?.id || currentTheme, // Theme ID becomes the style
                        primaryColor: themeDef?.config?.primaryColor || config.primaryColor || '#e11d48',
                        features: selectedFeatures,
                        accentColor: COLORS.find(c => c.id === accentColor)?.color,
                        fontFamily: FONTS.find(f => f.id === selectedFont)?.name,
                        animationLevel
                    }
                }, '*');
                send();
                const interval = setInterval(send, 2000);
                return () => clearInterval(interval);
            }, [config, selectedFeatures, accentColor, selectedFont, animationLevel, currentTheme]);

            // Keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.metaKey || e.ctrlKey) {
                        if (e.key === 'p') { e.preventDefault(); setMode(m => m === 'desktop' ? 'mobile' : 'desktop'); }
                        if (e.key === 's') { e.preventDefault(); handleCheckout(); }
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            const themePrice = 20;
            const featurePrice = selectedFeatures.reduce((sum, fid) => (FEATURES.find(f => f.id === fid)?.price || 0) + sum, 0);
            const totalPrice = themePrice + featurePrice;

            // UPI Payment State
            const [upiModal, setUpiModal] = useState(null);

            const handleCheckout = async () => {
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#f43f5e', '#a855f7', '#fb7185'] });
                try {
                    const res = await fetch('/api/create-order', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            features: selectedFeatures,
                            theme: currentTheme,
                            config: config,
                            customerName: config.senderName || 'Guest',
                            customerEmail: ''
                        })
                    });
                    const data = await res.json();
                    if (data.orderId) {
                        setUpiModal(data); // Show UPI payment modal
                    } else {
                        alert('Order failed. Please try again.');
                    }
                } catch (e) {
                    console.error(e);
                    alert('Order failed. Please try again.');
                }
            };

            // Admin Bypass: Simulate completed payment for testing
            const handleAdminTestPublish = async () => {
                if (!isAdminMode) return alert('Admin mode not enabled');
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 }, colors: ['#22c55e', '#10b981', '#14b8a6'] });
                try {
                    const res = await fetch('/api/admin/test-publish', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            features: selectedFeatures,
                            theme: currentTheme,
                            config: { ...config, style: currentTheme },
                            adminKey: 'admin123changeme'
                        })
                    });
                    const data = await res.json();
                    if (data.success && data.valentineUrl) {
                        setOrderData({
                            valentineUrl: data.valentineUrl,
                            orderId: data.orderId || 'TEST-' + Date.now()
                        });
                        alert(`âœ… Test Valentine Created!\\n\\nURL: ${data.valentineUrl}`);
                    } else {
                        alert('Admin publish failed: ' + (data.error || 'Unknown error'));
                    }
                } catch (e) {
                    console.error('Admin Test Publish Error:', e);
                    alert('Admin publish failed. Check console for details.');
                }
            };


            const confirmPayment = async (transactionId) => {
                try {
                    const res = await fetch('/api/confirm-payment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            orderId: upiModal.orderId,
                            transactionId,
                            config // Send config for when admin verifies
                        })
                    });
                    const data = await res.json();
                    if (data.success) {
                        // Check if it's pending verification or already verified
                        if (data.status === 'pending_verification') {
                            setOrderData({
                                orderId: data.orderId,
                                pending: true,
                                message: data.message
                            });
                        } else {
                            setOrderData({
                                orderId: data.orderId,
                                valentineId: data.valentineId,
                                shareUrl: data.shareUrl,
                                success: true
                            });
                        }
                        setUpiModal(null);
                    } else {
                        alert(data.error || 'Confirmation failed');
                    }
                } catch (e) {
                    alert('Confirmation failed. Please try again.');
                }
            };



            const toggleFeature = (id) => setSelectedFeatures(prev => prev.includes(id) ? prev.filter(f => f !== id) : [...prev, id]);
            const updateTimeline = (i, field, val) => { const t = [...config.timeline]; t[i][field] = val; setConfig({ ...config, timeline: t }); };
            const updateReason = (i, field, val) => { const r = [...config.reasons]; r[i][field] = val; setConfig({ ...config, reasons: r }); };
            const updateGallery = (i, val) => { const g = [...config.gallery]; g[i] = val; setConfig({ ...config, gallery: g }); };

            // Enhanced applyTemplate - applies theme, features, and config
            const applyTemplate = (template) => {
                const { theme, features, ...restConfig } = template.config;
                if (theme) setCurrentTheme(theme);
                if (features) setSelectedFeatures(features);
                setConfig({ ...config, ...restConfig });
                setAutoSaveStatus('saving');
                setTimeout(() => setAutoSaveStatus('saved'), 1000);
            };

            // File Upload Handlers
            const handlePhotoUpload = (e, index) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const newGallery = [...config.gallery];
                    if (index !== undefined) {
                        newGallery[index] = event.target.result;
                    } else {
                        newGallery.push(event.target.result);
                    }
                    setConfig({ ...config, gallery: newGallery });
                    setAutoSaveStatus('saving');
                    setTimeout(() => setAutoSaveStatus('saved'), 500);
                };
                reader.readAsDataURL(file);
            };

            const handleMusicUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    setConfig({ ...config, musicUrl: event.target.result });
                    setAutoSaveStatus('saving');
                    setTimeout(() => setAutoSaveStatus('saved'), 500);
                };
                reader.readAsDataURL(file);
            };

            const handleGiftUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    setConfig({ ...config, giftUrl: event.target.result });
                    setAutoSaveStatus('saving');
                    setTimeout(() => setAutoSaveStatus('saved'), 500);
                };
                reader.readAsDataURL(file);
            };

            const addGallerySlot = () => {
                setConfig({ ...config, gallery: [...config.gallery, ''] });
            };

            const removeGalleryImage = (index) => {
                const newGallery = config.gallery.filter((_, i) => i !== index);
                setConfig({ ...config, gallery: newGallery });
            };


            return (
                <div className={`layout-premium ${!activeSection ? 'panel-closed' : ''}`} data-theme={darkMode ? 'dark' : 'light'}>
                    {/* Gradient Mesh Background */}
                    <div className="gradient-mesh"></div>

                    {/* Progress Bar */}
                    <div className="progress-bar">
                        <div className="progress-fill" style={{ width: `${calculateProgress()}%` }}></div>
                    </div>

                    {/* SIDEBAR - FLOATING DOCK */}
                    <div className="dock-sidebar">
                        <div className="sidebar-logo" style={{ fontSize: 24, marginBottom: 10 }}>ğŸ’˜</div>

                        {/* User Account */}
                        {currentUser ? (
                            <div className="dock-item" data-tooltip={currentUser.name} onClick={() => { if (confirm(`Logged in as ${currentUser.email}\n\nLogout?`)) handleLogout(); }} style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-purple))', color: 'white' }}>
                                {currentUser.name.charAt(0).toUpperCase()}
                            </div>
                        ) : (
                            <div className="dock-item" data-tooltip="Login" onClick={() => setAuthModal('login')}>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>
                            </div>
                        )}

                        <div className="dock-divider"></div>

                        <div className={`dock-item ${activeSection === 'themes' ? 'active' : ''}`} data-tooltip="Themes" onClick={() => setActiveSection('themes')}>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="13.5" cy="6.5" r=".5" /><circle cx="17.5" cy="10.5" r=".5" /><circle cx="8.5" cy="7.5" r=".5" /><circle cx="6.5" cy="12.5" r=".5" /><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z" /></svg>
                        </div>

                        <div className={`dock-item ${activeSection === 'content' ? 'active' : ''}`} data-tooltip="Edit Content" onClick={() => setActiveSection('content')}>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></svg>
                        </div>

                        <div className={`dock-item ${activeSection === 'features' ? 'active' : ''}`} data-tooltip="Features" onClick={() => setActiveSection('features')}>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3z" /></svg>
                        </div>

                        <div className={`dock-item ${activeSection === 'gallery' ? 'active' : ''}`} data-tooltip="Gallery" onClick={() => setActiveSection('gallery')}>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><circle cx="9" cy="9" r="2" /><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" /></svg>
                        </div>

                        <div className={`dock-item ${activeSection === 'style' ? 'active' : ''}`} data-tooltip="Style" onClick={() => setActiveSection('style')}>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /><path d="M12 2v20C8.466 22 5.6 19.134 5.6 15.6c0-1.766 1.434-3.2 3.2-3.2.332 0 .66.032.978.096A4.39 4.39 0 0 1 12 11V2z" /></svg>
                        </div>

                        <div className="dock-divider"></div>

                        <div className={`dock-item ${activeSection === 'orders' ? 'active' : ''}`} data-tooltip="Orders" onClick={() => setActiveSection('orders')}>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="8" width="18" height="4" rx="1" /><path d="M12 8v13" /><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7" /><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5" /></svg>
                        </div>

                        <div style={{ flex: 1 }}></div>

                        <div className="dock-item" onClick={() => setDarkMode(!darkMode)}>
                            {darkMode ? (
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5" /><path d="M12 1v2" /><path d="M12 21v2" /><path d="M4.22 4.22l1.42 1.42" /><path d="M18.36 18.36l1.42 1.42" /><path d="M1 12h2" /><path d="M21 12h2" /><path d="M4.22 19.78l1.42-1.42" /><path d="M18.36 5.64l1.42-1.42" /></svg>
                            ) : (
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></svg>
                            )}
                        </div>
                    </div>


                    {/* CANVAS */}
                    <div className="canvas-area">
                        <div className="canvas-pattern"></div>
                        <div className="toolbar">
                            <button className={`toolbar-btn ${mode === 'desktop' ? 'active' : ''}`} onClick={() => setMode('desktop')}>Desktop</button>
                            <button className={`toolbar-btn ${mode === 'mobile' ? 'active' : ''}`} onClick={() => setMode('mobile')}>Mobile</button>
                            {mode === 'mobile' && (
                                <>
                                    <div className="toolbar-divider"></div>
                                    <button className={`toolbar-btn ${orientation === 'portrait' ? 'active' : ''}`} onClick={() => setOrientation('portrait')}>Portrait</button>
                                    <button className={`toolbar-btn ${orientation === 'landscape' ? 'active' : ''}`} onClick={() => setOrientation('landscape')}>Landscape</button>
                                </>
                            )}
                            <div className="toolbar-divider"></div>
                            <button className="toolbar-btn" onClick={() => setZoomLevel(Math.max(50, zoomLevel - 25))}>â–</button>
                            <span style={{ fontSize: '12px', color: '#a1a1aa', minWidth: '45px', textAlign: 'center' }}>{zoomLevel}%</span>
                            <button className="toolbar-btn" onClick={() => setZoomLevel(Math.min(150, zoomLevel + 25))}>â•</button>
                            <div className="toolbar-divider"></div>
                            <button className={`toolbar-btn ${soundEnabled ? 'active' : ''}`} onClick={() => setSoundEnabled(!soundEnabled)} title="Sound Effects">{soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡'}</button>
                            <div style={{ marginLeft: 'auto', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <span style={{ fontSize: '11px', color: autoSaveStatus === 'saved' ? '#22c55e' : '#f59e0b' }}>{autoSaveStatus === 'saved' ? 'âœ“ Saved' : 'â— Saving...'}</span>
                            </div>
                        </div>

                        <div className="preview-container">
                            {mode === 'desktop' ? (
                                <div className="preview-desktop">
                                    {loading && <div style={{ position: 'absolute', inset: 0, background: 'linear-gradient(135deg, #0f0c29, #302b63)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 5, borderRadius: 'var(--radius-lg)' }}>
                                        <div style={{ textAlign: 'center', color: 'white' }}>
                                            <span style={{ fontSize: 48, display: 'block', marginBottom: 16 }}>{themeDef?.icon || 'ğŸ’'}</span>
                                            <span className="loader"></span>
                                            <p style={{ marginTop: 16, opacity: 0.7 }}>Loading {themeDef?.name || 'template'}...</p>
                                        </div>
                                    </div>}
                                    <iframe
                                        ref={iframeRef}
                                        src={`./templates/${templateDir}/index.html`}
                                        style={{ width: '100%', height: '100%', border: 'none', borderRadius: 'var(--radius-lg)' }}
                                        onLoad={() => setTimeout(() => setLoading(false), 500)}
                                        onError={() => setLoading(false)}
                                    />
                                </div>
                            ) : (
                                <div className={`titanium-frame ${orientation === 'landscape' ? 'landscape' : ''}`}>
                                    <div className="titanium-screen">
                                        {orientation === 'portrait' && <div className="titanium-notch"></div>}
                                        {loading && <div style={{ position: 'absolute', inset: 0, background: 'linear-gradient(135deg, #0f0c29, #302b63)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 5 }}>
                                            <div style={{ textAlign: 'center', color: 'white' }}>
                                                <span style={{ fontSize: 32, display: 'block', marginBottom: 12 }}>{themeDef?.icon || 'ğŸ’'}</span>
                                                <span className="loader"></span>
                                            </div>
                                        </div>}
                                        <iframe
                                            ref={iframeRef}
                                            src={`./templates/${templateDir}/index.html`}
                                            style={{ width: '100%', height: '100%', border: 'none' }}
                                            onLoad={() => setTimeout(() => setLoading(false), 500)}
                                            onError={() => setLoading(false)}
                                        />
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* RIGHT PANEL */}
                    {
                        activeSection && (
                            <div className="right-panel">
                                <div className="panel-header">
                                    <div>
                                        <div className="panel-title">
                                            {activeSection === 'orders' && 'ğŸ My Valentines'}
                                            {activeSection === 'themes' && 'ğŸ¨ Choose Theme'}
                                            {activeSection === 'content' && 'âœï¸ Edit Content'}
                                            {activeSection === 'features' && 'âœ¨ Add Features'}
                                            {activeSection === 'gallery' && 'ğŸ“¸ Photo Gallery'}
                                            {activeSection === 'timeline' && 'ğŸ“… Our Story'}
                                            {activeSection === 'style' && 'ğŸ­ Customize Style'}
                                            {activeSection === 'templates' && 'ğŸ“‹ Quick Templates'}
                                            {activeSection === 'settings' && 'âš™ï¸ Settings'}
                                        </div>
                                        <div className="panel-subtitle">
                                            {activeSection === 'orders' && 'Your purchase history & links'}
                                            {activeSection === 'themes' && `${THEMES.length} beautiful themes`}
                                            {activeSection === 'style' && 'Colors, fonts & animations'}
                                            {activeSection === 'templates' && 'One-click setup'}
                                        </div>
                                    </div>
                                    <button className="panel-close" onClick={() => setActiveSection(null)}>âœ•</button>
                                </div>
                                <div className="panel-body">

                                    {/* MY ORDERS SECTION */}
                                    {activeSection === 'orders' && (
                                        <div className="orders-list" style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                                            {!currentUser ? (
                                                <div style={{ textAlign: 'center', padding: 40, color: 'var(--text-muted)' }}>
                                                    <div style={{ fontSize: 40, marginBottom: 10 }}>ğŸ”’</div>
                                                    <p>Please login to view your gifts.</p>
                                                    <button className="btn-primary" onClick={() => setAuthModal('login')} style={{ marginTop: 20 }}>Login</button>
                                                </div>
                                            ) : loadingOrders ? (
                                                <div style={{ display: 'flex', justifyContent: 'center', padding: 40 }}><span className="loader"></span></div>
                                            ) : myOrders.length === 0 ? (
                                                <div style={{ textAlign: 'center', padding: 40, color: 'var(--text-muted)' }}>
                                                    <div style={{ fontSize: 40, marginBottom: 10 }}>ğŸ’</div>
                                                    <p>You haven't created any valentines yet.</p>
                                                    <button className="btn-primary" onClick={() => setActiveSection('themes')} style={{ marginTop: 20 }}>Create One Now</button>
                                                </div>
                                            ) : (
                                                myOrders.map(order => (
                                                    <div key={order.orderId} className="card" style={{ padding: 16, border: order.status === 'paid' ? '1px solid var(--accent)' : '1px solid var(--border)' }}>
                                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                                                            <div style={{ fontWeight: 600, color: 'white' }}>{order.config?.partnerName || 'Valentine'}</div>
                                                            <span style={{
                                                                fontSize: 10, padding: '4px 8px', borderRadius: 10,
                                                                background: order.status === 'paid' ? '#22c55e' : (order.status === 'awaiting_verification' ? '#f59e0b' : '#ef4444'),
                                                                color: '#000'
                                                            }}>
                                                                {order.status === 'paid' ? 'Active' : (order.status === 'awaiting_verification' ? 'Pending' : 'Unpaid')}
                                                            </span>
                                                        </div>
                                                        <div style={{ fontSize: 12, color: 'var(--text-muted)', marginBottom: 12 }}>
                                                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                                                <span>To: {order.config?.partnerName || 'My Love'}</span>
                                                                <span>â‚¹{order.amount}</span>
                                                            </div>
                                                            Theme: {THEMES.find(t => t.id === order.theme)?.name || order.theme}<br />
                                                            Date: {new Date(order.createdAt).toLocaleDateString()}
                                                        </div>

                                                        {order.status === 'paid' && order.valentineId && (
                                                            <div style={{ display: 'flex', gap: 8 }}>
                                                                <button className="btn-secondary" style={{ flex: 1, fontSize: 12 }} onClick={() => window.open(`/v/${order.valentineId}`, '_blank')}>View</button>
                                                                <button className="btn-secondary" style={{ flex: 1, fontSize: 12 }} onClick={() => { navigator.clipboard.writeText(`${window.location.origin}/v/${order.valentineId}`); alert('Link copied!'); }}>Copy Link</button>
                                                            </div>
                                                        )}

                                                        {order.status === 'awaiting_verification' && (
                                                            <button
                                                                className="btn-secondary"
                                                                style={{ width: '100%', fontSize: 12, color: '#f59e0b' }}
                                                                onClick={() => window.open(`https://wa.me/918709157822?text=Hi! checking status for Order: ${order.orderId}`, '_blank')}
                                                            >
                                                                â³ Check Status on WhatsApp
                                                            </button>
                                                        )}

                                                        {order.status === 'pending' && (
                                                            <div style={{ fontSize: 11, color: '#ef4444', textAlign: 'center' }}>Payment not completed</div>
                                                        )}
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    )}

                                    {/* THEMES SECTION */}
                                    {activeSection === 'themes' && (
                                        <div className="theme-carousel">
                                            {THEMES.filter(t => weekMode === 'all' || t.tags?.includes(weekMode) || t.id === VALENTINE_WEEK.find(d => d.id === weekMode)?.theme).map(theme => (
                                                <div key={theme.id} className={`carousel-card ${currentTheme === theme.id ? 'active' : ''}`} onClick={() => setCurrentTheme(theme.id)}>
                                                    <div className="carousel-preview-bg" style={{ background: theme.bg }}></div>
                                                    <div className="carousel-info">
                                                        <div className="carousel-title">{theme.name}</div>
                                                        <div style={{ fontSize: 12, opacity: 0.8 }}>{theme.icon} Premium Theme</div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* CONTENT SECTION */}
                                    {activeSection === 'content' && (
                                        <>
                                            <div className="form-group">
                                                <label className="form-label">â¤ï¸ Partner's Name</label>
                                                <input className="form-input" value={config.partnerName} onChange={e => setConfig({ ...config, partnerName: e.target.value })} placeholder="Their name" />
                                            </div>
                                            <div className="form-group">
                                                <label className="form-label">âœ¨ Romantic Tagline</label>
                                                <input className="form-input" value={config.tagline} onChange={e => setConfig({ ...config, tagline: e.target.value })} placeholder="Short tagline" />
                                            </div>
                                            <div className="form-group">
                                                <label className="form-label">ğŸ’Œ Your Name</label>
                                                <input className="form-input" value={config.senderName} onChange={e => setConfig({ ...config, senderName: e.target.value })} placeholder="Your name" />
                                            </div>
                                            <div className="form-group">
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 10 }}>
                                                    <label className="form-label" style={{ margin: 0 }}>ğŸ’• Love Letter</label>
                                                    <button onClick={() => setAiModalOpen(true)} style={{ fontSize: 12, padding: '6px 14px', background: 'linear-gradient(135deg,#6366f1,#a855f7)', color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer', fontWeight: 600 }}>âœ¨ AI Magic Write</button>
                                                </div>
                                                <textarea className="form-input form-textarea" value={config.message} onChange={e => setConfig({ ...config, message: e.target.value })}></textarea>
                                            </div>

                                            <div style={{ marginTop: 20 }}>
                                                <label className="form-label">ğŸ’– Reasons I Love You</label>
                                                <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                                                    {config.reasons.map((reason, i) => (
                                                        <div key={i} className="card" style={{ padding: 12 }}>
                                                            <input className="form-input" style={{ marginBottom: 8, fontSize: 13, fontWeight: 600 }} value={reason.title} onChange={e => updateReason(i, 'title', e.target.value)} placeholder="Title" />
                                                            <textarea className="form-input" style={{ fontSize: 12, minHeight: 40 }} value={reason.body} onChange={e => updateReason(i, 'body', e.target.value)} placeholder="Why?"></textarea>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </>
                                    )}

                                    {/* FEATURES SECTION */}
                                    {activeSection === 'features' && (
                                        <>
                                            <p style={{ fontSize: 13, color: 'var(--text-muted)', marginBottom: 20 }}>Select features to include in your Valentine's page.</p>
                                            <div className="feature-grid">
                                                {FEATURES.map(f => (
                                                    <div key={f.id} className={`feature-item ${selectedFeatures.includes(f.id) ? 'active' : ''}`} onClick={() => toggleFeature(f.id)}>
                                                        <div className="icon">{f.icon}</div>
                                                        <div className="name">{f.label}</div>
                                                        <div className="price">â‚¹{f.price}</div>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* Music Upload */}
                                            {selectedFeatures.includes('feature_music') && (
                                                <div className="card" style={{ marginTop: 20, padding: 16 }}>
                                                    <div className="form-label">ğŸµ Background Music</div>
                                                    <input className="form-input" style={{ marginBottom: 10 }} value={config.musicUrl} onChange={(e) => setConfig({ ...config, musicUrl: e.target.value })} placeholder="Paste music URL..." />
                                                    <div style={{ display: 'flex', gap: 10 }}>
                                                        <label style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8, padding: '12px', background: 'var(--bg-primary)', border: '1px dashed var(--border)', borderRadius: 10, cursor: 'pointer', color: 'var(--accent)', fontSize: 12 }}>
                                                            <input type="file" accept="audio/*" style={{ display: 'none' }} onChange={handleMusicUpload} />
                                                            ğŸ“¤ Upload
                                                        </label>
                                                        <button onClick={toggleRecording} style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8, padding: '12px', background: isRecording ? '#ef4444' : 'var(--bg-primary)', border: '1px solid var(--border)', borderRadius: 10, cursor: 'pointer', color: isRecording ? 'white' : 'var(--accent)', fontSize: 12 }}>
                                                            {isRecording ? 'â¹ Stop' : 'ğŸ¤ Record Voice'}
                                                        </button>
                                                    </div>
                                                    {config.musicUrl && config.musicUrl.startsWith('data:') && <p style={{ fontSize: 11, color: '#22c55e', marginTop: 8 }}>âœ“ Audio loaded</p>}
                                                </div>
                                            )}

                                            {/* Gift Upload */}
                                            {selectedFeatures.includes('feature_gift') && (
                                                <div className="card" style={{ marginTop: 12, padding: 16 }}>
                                                    <div className="form-label">ğŸ Gift Image</div>
                                                    <input className="form-input" style={{ marginBottom: 10 }} value={config.giftUrl} onChange={(e) => setConfig({ ...config, giftUrl: e.target.value })} placeholder="Paste gift image URL..." />
                                                    <label style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8, padding: '12px 16px', background: 'var(--bg-primary)', border: '1px dashed var(--border)', borderRadius: 10, cursor: 'pointer', color: 'var(--accent)', fontSize: 13 }}>
                                                        <input type="file" accept="image/*" style={{ display: 'none' }} onChange={handleGiftUpload} />
                                                        ğŸ“¤ Upload Gift Image
                                                    </label>
                                                    {config.giftUrl && <div style={{ marginTop: 10, borderRadius: 10, overflow: 'hidden', maxWidth: 120 }}><img src={config.giftUrl} style={{ width: '100%', height: 80, objectFit: 'cover' }} /></div>}
                                                </div>
                                            )}
                                        </>
                                    )}


                                    {/* GALLERY SECTION */}
                                    {activeSection === 'gallery' && (
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                                            <p style={{ fontSize: 12, color: 'var(--text-muted)', marginBottom: 8 }}>Upload photos from your device or paste URLs</p>
                                            {config.gallery.map((url, i) => (
                                                <div key={i} className="card" style={{ display: 'flex', gap: 12, alignItems: 'center', padding: 12 }}>
                                                    <div style={{ width: 60, height: 60, borderRadius: 10, background: '#1a1a1a', overflow: 'hidden', flexShrink: 0, position: 'relative' }}>
                                                        {url && <img src={url} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />}
                                                        {!url && <span style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%', color: 'var(--text-muted)', fontSize: 20 }}>ğŸ“·</span>}
                                                    </div>
                                                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: 6 }}>
                                                        <input className="form-input" style={{ marginBottom: 0, fontSize: 12 }} value={url} onChange={e => updateGallery(i, e.target.value)} placeholder="Paste image URL..." />
                                                        <label style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: 'var(--accent)', cursor: 'pointer' }}>
                                                            <input type="file" accept="image/*" style={{ display: 'none' }} onChange={(e) => handlePhotoUpload(e, i)} />
                                                            ğŸ“¤ Upload from device
                                                        </label>
                                                    </div>
                                                    <button style={{ width: 32, height: 32, borderRadius: 8, background: 'transparent', border: '1px solid var(--border)', color: '#ef4444', cursor: 'pointer', fontSize: 16 }} onClick={() => removeGalleryImage(i)}>Ã—</button>
                                                </div>
                                            ))}
                                            <div style={{ display: 'flex', gap: 10 }}>
                                                <button className="btn-secondary" style={{ flex: 1 }} onClick={addGallerySlot}>+ Add Photo Slot</button>
                                                <label className="btn-secondary" style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer' }}>
                                                    <input type="file" accept="image/*" style={{ display: 'none' }} onChange={(e) => handlePhotoUpload(e)} />
                                                    ğŸ“¤ Upload New
                                                </label>
                                            </div>
                                        </div>
                                    )}


                                    {/* TIMELINE SECTION */}
                                    {activeSection === 'timeline' && (
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>
                                            {config.timeline.map((item, i) => (
                                                <div key={i} className="card">
                                                    <div className="form-group" style={{ marginBottom: 12 }}><input className="form-input" value={item.title} onChange={e => updateTimeline(i, 'title', e.target.value)} placeholder="Event title" /></div>
                                                    <div className="form-group" style={{ marginBottom: 12 }}><input className="form-input" value={item.date} onChange={e => updateTimeline(i, 'date', e.target.value)} placeholder="Date" /></div>
                                                    <textarea className="form-input" style={{ minHeight: 70, resize: 'none' }} value={item.description} onChange={e => updateTimeline(i, 'description', e.target.value)} placeholder="Description..."></textarea>
                                                </div>
                                            ))}
                                            <button className="btn-secondary" onClick={() => setConfig({ ...config, timeline: [...config.timeline, { date: "Year", title: "New Event", description: "..." }] })}>+ Add Event</button>
                                        </div>
                                    )}

                                    {/* STYLE SECTION */}
                                    {activeSection === 'style' && (
                                        <>
                                            <div className="form-group">
                                                <label className="form-label">ğŸ¨ Accent Color</label>
                                                <div className="color-grid">
                                                    {COLORS.map(c => (
                                                        <div key={c.id} className={`color-swatch ${accentColor === c.id ? 'active' : ''}`} style={{ background: c.color }} onClick={() => setAccentColor(c.id)} title={c.name}></div>
                                                    ))}
                                                </div>
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">ğŸ”¤ Font Style</label>
                                                {FONTS.map(f => (
                                                    <div key={f.id} className={`font-option ${selectedFont === f.id ? 'active' : ''}`} onClick={() => setSelectedFont(f.id)}>
                                                        <span className="font-preview" style={{ fontFamily: f.style }}>{f.preview}</span>
                                                        <span className="font-name">{f.name}</span>
                                                    </div>
                                                ))}
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">âœ¨ Animation Intensity</label>
                                                <div className="slider-container">
                                                    <input type="range" className="slider" min="1" max="3" value={animationLevel} onChange={e => setAnimationLevel(parseInt(e.target.value))} />
                                                    <div className="slider-labels">
                                                        <span>Subtle</span>
                                                        <span>Medium</span>
                                                        <span>Maximum</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </>
                                    )}

                                    {/* TEMPLATES SECTION */}
                                    {activeSection === 'templates' && (
                                        <div className="template-grid">
                                            {TEMPLATES.map(t => (
                                                <div key={t.id} className="template-card" onClick={() => applyTemplate(t)}>
                                                    <div className="template-card-header">
                                                        <span className="template-card-icon">{t.icon}</span>
                                                        <span className="template-card-title">{t.name}</span>
                                                    </div>
                                                    <p className="template-card-desc">{t.desc}</p>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* SETTINGS SECTION */}
                                    {activeSection === 'settings' && (
                                        <>
                                            {/* Animation Effects */}
                                            <div className="form-group">
                                                <label className="form-label">âœ¨ Animation Effects</label>
                                                <div className="effects-grid">
                                                    <div className={`effect-item ${config.effects?.hearts ? 'active' : ''}`} onClick={() => setConfig({ ...config, effects: { ...config.effects, hearts: !config.effects?.hearts } })}>
                                                        <span className="icon">ğŸ’•</span>
                                                        <span>Hearts</span>
                                                    </div>
                                                    <div className={`effect-item ${config.effects?.sparkles ? 'active' : ''}`} onClick={() => setConfig({ ...config, effects: { ...config.effects, sparkles: !config.effects?.sparkles } })}>
                                                        <span className="icon">âœ¨</span>
                                                        <span>Sparkles</span>
                                                    </div>
                                                    <div className={`effect-item ${config.effects?.bubbles ? 'active' : ''}`} onClick={() => setConfig({ ...config, effects: { ...config.effects, bubbles: !config.effects?.bubbles } })}>
                                                        <span className="icon">ğŸ«§</span>
                                                        <span>Bubbles</span>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Password Lock */}
                                            <div className="form-group">
                                                <label className="form-label">ğŸ” Password Lock</label>
                                                <input type="password" className="form-input" style={{ textAlign: 'center', letterSpacing: '0.4em', fontSize: 20 }} value={config.password} onChange={e => setConfig({ ...config, password: e.target.value })} placeholder="â€¢â€¢â€¢â€¢" maxLength={6} />
                                            </div>

                                            {/* Share & Export */}
                                            <div style={{ borderTop: '1px solid var(--border)', paddingTop: 24, marginTop: 12 }}>
                                                <label className="form-label">ğŸ“¤ Share & Export</label>
                                                <div className="share-buttons" style={{ marginBottom: 12 }}>
                                                    <button className="share-btn whatsapp" onClick={() => window.open(`https://wa.me/?text=${encodeURIComponent('Check out my Valentine! ' + previewUrl)}`)}>
                                                        ğŸ’¬ WhatsApp
                                                    </button>
                                                    <button className="share-btn copy" onClick={() => { navigator.clipboard.writeText(previewUrl); alert('Link copied!'); }}>
                                                        ğŸ“‹ Copy
                                                    </button>
                                                </div>
                                                <button className="share-btn download" style={{ width: '100%' }} onClick={() => alert('Download feature coming soon!')}>
                                                    ğŸ“¥ Download as Image
                                                </button>
                                            </div>

                                            {/* QR Code */}
                                            <div style={{ borderTop: '1px solid var(--border)', paddingTop: 24, marginTop: 24 }}>
                                                <label className="form-label">ğŸ“± Share via QR</label>
                                                <div style={{ background: 'white', padding: 20, borderRadius: 16, display: 'flex', justifyContent: 'center' }}><img src={qrCodeUrl} style={{ width: 140, height: 140 }} /></div>
                                                <p style={{ fontSize: 11, color: 'var(--text-muted)', textAlign: 'center', marginTop: 12, wordBreak: 'break-all' }}>{previewUrl}</p>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        )
                    }

                    {/* SUCCESS / PENDING MODAL */}
                    <div className={`modal-backdrop ${orderData ? 'open' : ''}`}>
                        <div className="modal-card" style={{ maxWidth: 420 }}>
                            {/* PENDING VERIFICATION */}
                            {orderData?.pending ? (
                                <>
                                    <div style={{ fontSize: 56, marginBottom: 20 }}>â³</div>
                                    <h2 style={{ fontSize: 24, fontWeight: 800, marginBottom: 8 }}>Payment Submitted!</h2>
                                    <p style={{ color: 'var(--text-muted)', fontSize: 14, marginBottom: 20 }}>
                                        Your payment is being verified. You'll receive your Valentine link soon!
                                    </p>

                                    <div style={{ background: 'rgba(34, 197, 94, 0.1)', border: '1px solid #22c55e', padding: 16, borderRadius: 14, marginBottom: 16 }}>
                                        <div style={{ fontSize: 13, color: '#22c55e', fontWeight: 600, marginBottom: 8 }}>âœ… What happens next?</div>
                                        <div style={{ fontSize: 12, color: 'var(--text-secondary)', lineHeight: 1.6 }}>
                                            1. We verify your payment (1-2 hours)<br />
                                            2. Your Valentine link is generated<br />
                                            3. Contact us on WhatsApp for instant delivery!
                                        </div>
                                    </div>

                                    <div style={{ background: 'var(--bg-tertiary)', padding: 12, borderRadius: 10, marginBottom: 16 }}>
                                        <div style={{ fontSize: 11, color: 'var(--text-muted)', marginBottom: 4 }}>Order ID (save this!)</div>
                                        <div style={{ fontFamily: 'monospace', fontSize: 16, color: 'var(--accent-purple)' }}>{orderData?.orderId}</div>
                                    </div>

                                    <button
                                        className="btn-primary"
                                        onClick={() => window.open(`https://wa.me/918709157822?text=Hi! I just paid for Order: ${orderData?.orderId}. Please verify my payment.`, '_blank')}
                                        style={{ width: '100%', marginBottom: 10 }}
                                    >
                                        ğŸ“± WhatsApp for Instant Link
                                    </button>
                                    <button className="btn-secondary" onClick={() => setOrderData(null)} style={{ width: '100%' }}>Close</button>
                                </>
                            ) : orderData?.success ? (
                                <>
                                    {/* VERIFIED - SHOW SHARE LINK */}
                                    <div style={{ fontSize: 56, marginBottom: 20 }}>ğŸ‰</div>
                                    <h2 style={{ fontSize: 24, fontWeight: 800, marginBottom: 8 }}>Payment Verified!</h2>
                                    <p style={{ color: 'var(--text-muted)', fontSize: 14, marginBottom: 20 }}>Your Valentine's page is live! Share it with your loved one:</p>

                                    {orderData?.shareUrl && (
                                        <div style={{ background: 'var(--bg-primary)', padding: 16, borderRadius: 14, marginBottom: 16, border: '2px solid var(--accent)' }}>
                                            <div style={{ fontSize: 11, color: 'var(--text-muted)', marginBottom: 6 }}>ğŸ’• YOUR VALENTINE LINK</div>
                                            <div style={{ fontFamily: 'monospace', fontSize: 14, color: 'var(--accent)', wordBreak: 'break-all', marginBottom: 12 }}>
                                                {window.location.origin}{orderData.shareUrl}
                                            </div>
                                            <div style={{ display: 'flex', gap: 8 }}>
                                                <button
                                                    className="btn-secondary"
                                                    style={{ flex: 1, padding: 10, fontSize: 13 }}
                                                    onClick={() => {
                                                        navigator.clipboard.writeText(window.location.origin + orderData.shareUrl);
                                                        alert('Link copied! ğŸ’•');
                                                    }}
                                                >
                                                    ğŸ“‹ Copy Link
                                                </button>
                                                <button
                                                    className="btn-primary"
                                                    style={{ flex: 1, padding: 10, fontSize: 13 }}
                                                    onClick={() => {
                                                        const url = window.location.origin + orderData.shareUrl;
                                                        const text = `I made something special for you! ğŸ’•\n${url}`;
                                                        window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
                                                    }}
                                                >
                                                    ğŸ“± WhatsApp
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    <div style={{ background: 'var(--bg-tertiary)', padding: 12, borderRadius: 10, marginBottom: 20 }}>
                                        <div style={{ fontSize: 11, color: 'var(--text-muted)' }}>Order ID: <span style={{ color: 'var(--accent-purple)' }}>{orderData?.orderId}</span></div>
                                    </div>

                                    <button className="btn-secondary" onClick={() => setOrderData(null)} style={{ width: '100%' }}>Close</button>
                                </>
                            ) : null}
                        </div>
                    </div>

                    {/* AI MODAL */}
                    <div className={`modal-backdrop ${aiModalOpen ? 'open' : ''}`} onClick={(e) => e.target.className.includes('modal-backdrop') && setAiModalOpen(false)}>
                        <div className="modal-card">
                            <div style={{ fontSize: 48, marginBottom: 16 }}>âœ¨</div>
                            <h2 style={{ fontSize: 20, fontWeight: 700, marginBottom: 8 }}>Magic Writer</h2>
                            <p style={{ color: 'var(--text-muted)', fontSize: 13, marginBottom: 24 }}>Select a mood for your love letter.</p>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10, marginBottom: 20 }}>
                                {['Romantic', 'Funny', 'Poetic', 'Short'].map(m => (
                                    <button key={m} className="btn-secondary" onClick={() => generateLoveLetter(m.toLowerCase())} style={{ padding: 12 }}>{m}</button>
                                ))}
                            </div>
                            <button className="btn-no" style={{ width: '100%', padding: 12, border: 'none', background: 'transparent', color: 'var(--text-muted)', cursor: 'pointer' }} onClick={() => setAiModalOpen(false)}>Cancel</button>
                        </div>
                    </div>

                    {/* AUTH MODAL */}
                    {
                        authModal && (
                            <div className="modal-backdrop open" onClick={(e) => e.target.className.includes('modal-backdrop') && setAuthModal(null)}>
                                <div className="modal-card" style={{ maxWidth: 380 }}>
                                    <div style={{ fontSize: 48, marginBottom: 16 }}>{authModal === 'login' ? 'ğŸ”' : 'ğŸ‘¤'}</div>
                                    <h2 style={{ fontSize: 20, fontWeight: 700, marginBottom: 8 }}>
                                        {authModal === 'login' ? 'Welcome Back!' : 'Create Account'}
                                    </h2>
                                    <p style={{ color: 'var(--text-muted)', fontSize: 13, marginBottom: 20 }}>
                                        {authModal === 'login' ? 'Login to save your valentines' : 'Sign up to save & manage valentines'}
                                    </p>

                                    {authError && (
                                        <div style={{ background: 'rgba(239, 68, 68, 0.1)', border: '1px solid #ef4444', padding: 10, borderRadius: 8, marginBottom: 16, color: '#ef4444', fontSize: 13 }}>
                                            {authError}
                                        </div>
                                    )}

                                    <form onSubmit={(e) => {
                                        e.preventDefault();
                                        const form = e.target;
                                        if (authModal === 'login') {
                                            handleLogin(form.email.value, form.password.value);
                                        } else {
                                            handleRegister(form.name.value, form.email.value, form.password.value);
                                        }
                                    }}>
                                        {authModal === 'register' && (
                                            <input name="name" className="form-input" placeholder="Your Name" required style={{ marginBottom: 10 }} />
                                        )}
                                        <input name="email" type="email" className="form-input" placeholder="Email" required style={{ marginBottom: 10 }} />
                                        <input name="password" type="password" className="form-input" placeholder="Password (min 6 chars)" required minLength="6" style={{ marginBottom: 16 }} />

                                        <button type="submit" className="btn-primary" disabled={authLoading} style={{ width: '100%', marginBottom: 12 }}>
                                            {authLoading ? '...' : (authModal === 'login' ? 'Login' : 'Create Account')}
                                        </button>
                                    </form>

                                    <div style={{ fontSize: 13, color: 'var(--text-muted)' }}>
                                        {authModal === 'login' ? (
                                            <>Don't have an account? <span style={{ color: 'var(--accent)', cursor: 'pointer' }} onClick={() => { setAuthModal('register'); setAuthError(''); }}>Sign Up</span></>
                                        ) : (
                                            <>Already have an account? <span style={{ color: 'var(--accent)', cursor: 'pointer' }} onClick={() => { setAuthModal('login'); setAuthError(''); }}>Login</span></>
                                        )}
                                    </div>

                                    <button
                                        style={{ width: '100%', padding: 12, border: 'none', background: 'transparent', color: 'var(--text-muted)', cursor: 'pointer', marginTop: 12 }}
                                        onClick={() => setAuthModal(null)}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        )
                    }

                    {/* UPI PAYMENT MODAL */}
                    {
                        upiModal && (
                            <div className="modal-backdrop open" onClick={(e) => e.target.className.includes('modal-backdrop') && setUpiModal(null)}>
                                <div className="modal-card" style={{ maxWidth: 400 }}>
                                    <div style={{ fontSize: 48, marginBottom: 16 }}>ğŸ’³</div>
                                    <h2 style={{ fontSize: 20, fontWeight: 700, marginBottom: 8 }}>Pay with UPI</h2>
                                    <p style={{ color: 'var(--text-muted)', fontSize: 13, marginBottom: 16 }}>Scan QR or use UPI ID to pay</p>

                                    <div style={{ background: 'white', padding: 16, borderRadius: 16, marginBottom: 16 }}>
                                        <img src={upiModal.qrUrl} alt="UPI QR" style={{ width: '100%', maxWidth: 180, margin: '0 auto', display: 'block' }} />
                                    </div>

                                    <div style={{ background: 'var(--bg-tertiary)', padding: 16, borderRadius: 12, marginBottom: 16 }}>
                                        <div style={{ fontSize: 12, color: 'var(--text-muted)', marginBottom: 4 }}>Amount</div>
                                        <div style={{ fontSize: 28, fontWeight: 700, color: 'var(--accent)' }}>â‚¹{upiModal.amount}</div>
                                        <div style={{ fontSize: 11, color: 'var(--text-muted)', marginTop: 8 }}>
                                            UPI ID: <strong style={{ color: 'var(--text-secondary)' }}>{upiModal.upiId}</strong>
                                        </div>
                                        <div style={{ fontSize: 11, color: 'var(--text-muted)', marginTop: 4 }}>
                                            Order: <strong style={{ color: 'var(--accent-purple)' }}>{upiModal.orderId}</strong>
                                        </div>
                                    </div>

                                    <p style={{ fontSize: 12, color: 'var(--text-muted)', marginBottom: 12 }}>After payment, enter your UPI Transaction ID:</p>
                                    <input
                                        id="txnInput"
                                        className="form-input"
                                        placeholder="e.g. 401234567890"
                                        style={{ marginBottom: 12, textAlign: 'center', letterSpacing: '0.05em' }}
                                    />
                                    <button
                                        className="btn-primary"
                                        onClick={() => {
                                            const txn = document.getElementById('txnInput').value;
                                            if (txn.length > 5) confirmPayment(txn);
                                            else alert('Please enter valid Transaction ID');
                                        }}
                                    >
                                        âœ… I've Paid - Confirm
                                    </button>
                                    <button
                                        style={{ width: '100%', padding: 12, border: 'none', background: 'transparent', color: 'var(--text-muted)', cursor: 'pointer', marginTop: 8 }}
                                        onClick={() => setUpiModal(null)}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        )
                    }


                    {/* FLOATING BOTTOM ACTION BAR */}
                    <div className="bottom-action-bar">
                        <div className="live-badge">
                            <div className="live-dot"></div>
                            Editing
                        </div>
                        <div className="action-divider"></div>
                        <button className="action-btn" title="Undo">â†©ï¸ Undo</button>
                        <button className="action-btn" title="Redo">â†ªï¸ Redo</button>
                        <div className="action-divider"></div>
                        <button className="action-btn" onClick={() => setMode(mode === 'desktop' ? 'mobile' : 'desktop')}>
                            {mode === 'desktop' ? 'ğŸ“±' : 'ğŸ–¥ï¸'} {mode === 'desktop' ? 'Mobile' : 'Desktop'}
                        </button>
                        {isAdminMode && (
                            <button className="action-btn" style={{ background: 'linear-gradient(135deg, #22c55e, #10b981)', color: 'white' }} onClick={handleAdminTestPublish}>
                                ğŸ§ª Test Publish (Admin)
                            </button>
                        )}
                        <button className="action-btn primary" onClick={handleCheckout}>
                            ğŸš€ Publish â€” â‚¹{totalPrice}
                        </button>
                    </div>

                </div >
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>

</html>